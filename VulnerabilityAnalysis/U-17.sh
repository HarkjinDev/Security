#!/bin/bash

. function.sh

TMP1=`SCRIPTNAME`.log
> $TMP1

BAR
CODE "[U-17] $HOME/.rhosts, hosts.equiv 사용 금지"
cat << EOF >> $RESULT
[양호]:  /etc/hosts.equiv 및 \$HOME/.rhosts 파일 소유자가 root, 파일 권한이 600 이하인 경우, 파일 설정에 ‘+’ 설정이 없는 경우
[취약]:  /etc/hosts.equiv 및 \$HOME/.rhosts 파일 소유자가 root이 아닌 경우, 파일 권한이 600 이하가 아닌 경우, 파일 설정에 ‘+’ 설정이 있는 경우
EOF
BAR

TMP2=/tmp/tmp2
cat << EOF > $TMP2
/etc/hosts.equiv
$HOME/.rhosts
EOF

cat $TMP2 | while read FILENAME
do
	if [ -f $FILENAME ] ; then
		WARN r-command 서비스가 실행 중입니다.
		WARN $FILENAME 파일이 존재합니다.
		OWNER=$(ls -l $FILENAME | awk {'print $3'})
		PERM=$(ls -l $FILENAME | awk -F . {'print $1'})
		if [ $OWNER = "root" ] ; then
			OK $FILENAME 파일의 소유자가 root입니다.
		else
			WARN $FILENAME 파일의 소유자가 root가 아닙니다.
		fi

		if [ $PERM = "-rw-------" ] ; then
			OK $FILENAME 파일의 권한이 600이하 입니다.
		else
			WARN $FILENAME 파일의 권한이 600이하가 아닙니다.
		fi
	else
		OK $FILENAME 파일이 존재하지 않습니다.
		continue
	fi
done


cat $RESULT
