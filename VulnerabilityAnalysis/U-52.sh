#!/bin/bash

. function.sh
TMP1=`SCRIPTNAME`.log
> $TMP1

TMP2=$(mktemp)
TMP3=$(mktemp)

BAR
CODE [U-52] 동일한 UID 금지
cat << EOF >> $RESULT
양호: 동일한 UID로 설정된 사용자 계정이 존재하지 않는 경우
취약: 동일한 UID로 설정된 사용자 계정이 존재하는 경우
EOF
BAR

PASSFILE=/etc/passwd
awk -F: '{print $3}' $PASSFILE | sort -n | uniq -d > $TMP2
if [ -s $TMP2 ] ; then
	WARN 동일한 UID로 설정된 사용자 계정이 존재합니다.
	for i in $(cat $TMP2)
	do
		awk -v CHECK=$i -F: '$3 == CHECK {print $1, ":", $3}' $PASSFILE >> $TMP3
	done
	INFO $TMP1 파일을 참고하시요.
	cat << EOF >> $TMP1
==============================================================
1. 다음은 동일한 UID를 가지는 사용자를 /etc/passwd 검색한 내용입니다.

$(cat $TMP3)
==============================================================
EOF
else
	OK 동일한 UID로 설정된 사용자 계정이 존재하지 않습니다.
fi

cat $RESULT
