#!/bin/bash

. function.sh

TMP1=`SCRIPTNAME`.log
> $TMP1

BAR
CODE "[U-13] SUID, SGID, Sticky bit 설정 파일점검"
cat << EOF >> $RESULT
[양호]: 주요 실행파일의 권한에 SUID와 SGID에 대한 설정이 부여되어 있지 않은 경우
[취약]: 주요 실행파일의 권한에 SUID와 SGID에 대한 설정이 부여되어 있는 경우
EOF
BAR

TMP2=/tmp/tmp2
# File List
cat << EOF > $TMP2
/sbin/dump 
/sbin/restore
/usr/bin/newgrp
/sbin/unix_chkpwd 
/usr/bin/lpq-lpd 
/usr/bin/lpr 
/usr/sbin/lpc
/usr/bin/lpr-lpd 
/usr/sbin/lpc-lpd
/usr/bin/lpq 
/usr/bin/lprm-lpd
/usr/bin/lprm 
/usr/bin/at 
/usr/sbin/traceroute
EOF

cat $TMP2 | while read FILENAME
do
	if [ -f $FILENAME ] ; then
		ls -l $FILENAME | awk '{print $1}' | grep -i 's' > /dev/null 2>&1
		if [ $? -eq 0 ] ; then
			WARN $FILENAME Sticky Bit 설정이 되어있습니다.
		else
			OK $FILENAME Sticky Bit 설정이 안 되어있습니다.
		fi
	else
		INFO $FILENAME 파일이 존재하지 않습니다.
		continue
	fi
done

cat $RESULT
