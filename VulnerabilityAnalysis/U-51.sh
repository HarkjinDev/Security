#!/bin/bash

. function.sh
TMP1=`SCRIPTNAME`.log
> $TMP1

BAR
CODE [U-51] 계정이 존재하지 않는 GID 금지
cat << EOF >> $RESULT
[양호]: 존재하지 않는 계정에 GID 설정을 금지한 경우
[취약]: 존재하지 않은 계정에 GID 설정이 되어있는 경우
EOF
BAR

FILE1=/etc/group
FILE2=/etc/passwd
FILE3=/tmp/tmp1
awk -F: '{print $1}' $FILE2 > $FILE3
TRUEFALSE=1
for LINE1 in `cat $FILE1`
do
	GROUPNAME=`echo $LINE1 | awk -F: '{print $1}'`
	LINE2=`echo $LINE1 | awk -F: '{print $4}'`
	if [ -n $LINE2 ] ; then
		for CHECKUSER in `echo $LINE2 | sed 's/,/ /g'`
		do
			grep -w "^$CHECKUSER" $FILE3 >/dev/null 2>&1 
			if [ $? -ne 0 ] ; then
				echo "$GROUPNAME 에 속한 $CHECKUSER 사용자는 사용자가 존재하지 않습니다." >> $TMP1
				TRUEFALSE=0
			fi
		done
	fi
done
	
if [ $TRUEFALSE -eq 0 ] ; then
	WARN 그룹내에 존재하지 않는 계정이 포함되어 있습니다.
	INFO $TMP1 파일을 점검한다.
else
	OK 그룹내에 존재하지 않는 계정이 포함되어 있지 않습니다.
fi
cat $RESULT
echo
