#!/bin/bash

. function.sh

BAR
CODE [U-03] 계정 잠금 임계값 설정
cat << EOF >> $RESULT
[양호]: 계정 잠금 임계값이 5이하의 값으로 설정되어 있는 경우
[취약]: 계정 잠금 임계값이 설정되어 있지 않거나, 5이하의 값으로 설정되지 않은 경우
EOF
BAR

FILE1=/root/scripts/system-auth
PAM_MODULE=pam_tally2.so
LINE1=$(echo $(cat system-auth | egrep -v '(^$|^#)' | grep '^auth' | grep pam_tally2.so) | cut -d' ' -f4-)

if [ -z $LINE1 ]; then
	WARN '임계값이 설정되어 있지 않습니다.'
else
    for i in `echo $LINE1`
    do
    	KEY1=$(echo $i | awk -F= '{print $1}')
    	VALUE1=$(echo $i | awk -F= '{print $2}')
    	case $KEY1 in
    		deny) 	if [ $VALUE1 -le 5 ] ; then
    					OK '임계값이 5이하로 설정 되어 있습니다.'
    			  	else
    					WARN '임계값이 6이상으로 설정되어 있습니다.'
    			  	fi 
    				;;
    		*) : ;;
    	esac
    done
fi

cat $RESULT
echo ; echo
