#!/bin/bash

. function.sh

LOGFILE=`SCRIPTNAME`.log
> $LOGFILE

BAR
CODE [U-49] 불필요한 계정 제거
cat << EOF >> $RESULT
[양호]: 불필요한 계정이 존재하지 않는 경우
[취약]: 불필요한 계정이 존재하는 경우
EOF
BAR

INFO "$LOGFILE 파일을 참고"

cat $RESULT

# 1) /etc/passwd
# Description: 
# * 사용자 UID 번호 체계
# * 의심스러운 사용자일 가능성이 있는 내용 
# 2) lastlog CMD 출력 결과(/var/log/lastlog)
# Description:
# * 최근 로그인 한적 이 없는 사용자(1년)
# 3) /var/log/secure
# Description:
# * su 명령어 최근 실패 시도 기록 
# 4) lastb CMD 출력 결과(/var/log/btmp)
# Description:
# * 최근 원격 로그인 실패 시도 기록

USERFILE=/etc/passwd
SECURELOGFILE=/var/log/secure

cat << EOF 
========================================================================
1) /etc/passwd 파일의 내용
========================================================================
* 사용자 UID 번호 체계(0 ~ 65535) - CentOS 7.x
    - 0 ~ 999     : System Account
    - 1000 ~ 65535: Regular User
* 다음 사항에 해당 되는 사용자를 점검한다.
    - UID가 1 ~ 199번 사이인 사용자가 쉘(ex:/bin/bash)을 할당 받은 경우
========================================================================
$(cat $USERFILE)

========================================================================
2) lastlog CMD 출력 결과
========================================================================
* 최근 1년 안에 로그인한 적이 없는 사용자 점검
========================================================================
$(lastlog)

========================================================================
3) /var/log/secure 파일의 내용 중 su 명령어 실패 기록
========================================================================
* 비슷한 시간대에 반복적으로 실패하는 기록 확인
========================================================================
$(grep 'authentication failure;' /var/log/secure* | grep --color 'su: pam_unix')

========================================================================
4) lastb CMD 출력 결과(/var/log/btmp)
========================================================================
* 최근 원격 로그인 실패 시도 기록
========================================================================
$(lastb)
EOF
