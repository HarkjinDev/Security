#!/bin/bash

. function.sh

BAR
CODE [U-01] root 계정 원격 접속 제한
cat << EOF >> $RESULT
[양호]: 원격 서비스를 사용하지 않거나 사용시 직접 접속을 차단한 경우
[취약]: root 직접 접속을 허용하고 원격 서비스를 사용하는 경우
EOF
BAR

# TELNET Service Check
# STATUS1: active|inactive
STATUS1=`systemctl is-active telnet.socket`

# SSH Service Check
# STATUS2: active|inactive
# STATUS2_1: /etc/ssh/sshd_config
# PermitRootLogin No
STATUS2=`systemctl is-active sshd.socket`
STATUS2_1=`cat /etc/ssh/sshd_config | grep "PermitRootLogin No"`

# PAM Module Check
# STATUS3: /etc/pam.d/login
# auth required /lib/security/pam_securetty.so
STATUS3=`cat /etc/pam.d/login | grep "auth required /lib/security/pam_securetty.so"`

if [ $STATUS1 = 'inactive' ]; then
	OK 'TELNET 원격 서비스가 활성화 되어 있지 않습니다.'
else
	WARN 'TELNET 원격 서비스가 활성화 되어 있습니다.'
fi

if grep -q 'pts' /etc/securetty; then
	WARN '/etc/securetty 파일안에 pts/# 존재합니다. pts/x 관련 설정 제거 필요'
else
	OK '/etc/securetty 파일안에 pts/# 존재하지 않습니다.'
fi 

if [ $STATUS2 = 'inactive' ]; then
	OK 'SSH 원격 서비스가 활성화 되어 있지 않습니다.'
else
	WARN 'SSH 원격 서비스가 활성화 되어 있습니다.'
	if [ "$STATUS2_1" = "PermitRootLogin No" ]; then
		OK 'SSH Root 로그인 허용이 안 되어있습니다.'
	else
		WARN 'SSH Root 로그인 허용이 되어있습니다. /etc/ssh/sshd_config에서 PermitRootLogin No 추가 필요'
	fi
fi

if [ "$STATUS3" = "auth required /lib/security/pam_securetty.so" ]; then
	OK 'PAM 모듈 설정이 되어있습니다.'
else
	WARN 'PAM 모듈 설정이 안 되어있습니다. /etc/pam.d/login 에서 auth required /lib/security/pam_securetty.so 추가 필요'
fi

cat $RESULT
