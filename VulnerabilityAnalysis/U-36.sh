#!/bin/bash

. function.sh

TMP1=`SCRIPTNAME`.log
> $TMP1

BAR
CODE "[U-36] 웹서비스 웹 프로세스 권한 제한"
cat << EOF >> $RESULT
[양호]:  Apache 데몬이 root 권한으로 구동되지 않는 경우
[취약]:  Apache 데몬이 root 권한으로 구동되는 경우
EOF
BAR

SERVICE=$(systemctl is-active httpd.service)

if [ $SERVICE = "active" ] ; then
	INFO Apache 서비스가 활성화 되어있습니다.
	cat /etc/httpd/conf/httpd.conf | grep "User" | grep -v "#" | head -1 | awk {'print $2'} > $TMP1
	if [ $TMP1 == "root" ] ; then
		WARN Apache 데몬이 root 권한으로 구동되고 있습니다.
	else
		OK Apache 데몬이 root 권한으로 구동되고 있지 않습니다.
	fi
	cat /etc/httpd/conf/httpd.conf | grep "Group" | grep -v "#" | head -1 | awk {'print $2'} > $TMP1
	if [ $TMP1 == "root" ] ; then
		WARN Apache 데몬이 root 그룹 권한으로 구동되고 있습니다.
	else
		OK Apache 데몬이 root 그룹 권한으로 구동되고 있지 않습니다.
	fi
else
	OK Apache 서비스가 비활성화 되어있습니다.
fi

cat $RESULT
